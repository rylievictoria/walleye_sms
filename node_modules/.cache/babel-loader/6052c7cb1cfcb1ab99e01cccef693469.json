{"ast":null,"code":"import { GoogleSpreadsheet } from \"google-spreadsheet\";\nexport function filterNumbers(data, customers, phoneCol) {\n  let numbers = [];\n  let filters = Object.entries(data).filter(([key, value]) => value);\n\n  for (let q = 0; q < filters.length; q++) {\n    const [question, value] = filters[q].split('|||');\n    let options = customers[question];\n    console.log(options);\n  }\n\n  return;\n  let q_index = 0;\n  filters.forEach(f => {\n    const [question, value] = f[0].split('|||'); // Adds numbers by whether answer is or includes checked response (may need to edit)\n\n    if (question !== \"message\" && question !== phoneCol) {\n      let options = customers[q_index][1].options;\n\n      for (let i = 0; i < options.length; i++) {\n        console.log(options[i]);\n        console.log(value);\n        console.log(customers[phoneCol].options[i]);\n\n        if (options[i] === value) {\n          numbers.push(customers[phoneCol].options[i]);\n        } else if (options[i].indexOf(value) >= 0) {\n          numbers.push(customers[phoneCol].options[i]);\n        }\n      }\n    }\n\n    q_index++;\n  });\n  numbers = [...new Set(numbers)];\n  console.log(numbers);\n  return numbers;\n}\n\nfunction formatResponses(questions, responses) {\n  let obj = {};\n\n  for (let i = 0; i < questions.length; i++) {\n    let q = questions[i];\n    let all = [];\n    let a = responses.map(r => {\n      if (r[i] && r[i].trim()) {\n        all.push(...r[i].split(','));\n      }\n\n      return r[i];\n    });\n    all = [...new Set(all)];\n\n    if (all.length > 0) {\n      obj[q] = {\n        responses: a,\n        options: all\n      };\n    }\n  }\n\n  return obj;\n} // Fetch a Google Sheet\n\n\nexport async function getResponses(sheetLink) {\n  const sheetID = sheetLink.slice(sheetLink.lastIndexOf(\"/d/\") + 3, sheetLink.lastIndexOf('/edit#'));\n  const pageID = sheetLink.slice(sheetLink.lastIndexOf(\"gid=\") + 4, sheetLink.length);\n  const doc = new GoogleSpreadsheet(sheetID, pageID);\n\n  try {\n    await doc.useApiKey(process.env.REACT_APP_SHEETS_API_KEY);\n    await doc.loadInfo();\n    let sheet = doc.sheetsById[pageID];\n    let rows = await sheet.getRows();\n    let responses = rows.map(r => r._rawData);\n    await sheet.loadHeaderRow();\n    let questions = sheet.headerValues;\n    return formatResponses(questions, responses);\n  } catch (e) {\n    console.error('Error: ', e);\n  }\n}","map":{"version":3,"sources":["/Users/rhendren/walleye_sms/src/util/sheets.js"],"names":["GoogleSpreadsheet","filterNumbers","data","customers","phoneCol","numbers","filters","Object","entries","filter","key","value","q","length","question","split","options","console","log","q_index","forEach","f","i","push","indexOf","Set","formatResponses","questions","responses","obj","all","a","map","r","trim","getResponses","sheetLink","sheetID","slice","lastIndexOf","pageID","doc","useApiKey","process","env","REACT_APP_SHEETS_API_KEY","loadInfo","sheet","sheetsById","rows","getRows","_rawData","loadHeaderRow","headerValues","e","error"],"mappings":"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","sourcesContent":["import { GoogleSpreadsheet } from \"google-spreadsheet\";\n\nexport function filterNumbers(data, customers, phoneCol) {\n    let numbers = [];\n    let filters = Object.entries(data).filter(([key, value]) => value);\n\n    for(let q=0; q<filters.length; q++) {\n        const [question, value] = filters[q].split('|||');\n        let options = customers[question];\n        console.log(options);\n    }\n    return;\n    let q_index = 0;\n    filters.forEach((f) => {\n      const [question, value] = f[0].split('|||');\n      // Adds numbers by whether answer is or includes checked response (may need to edit)\n      \n      if (question !== \"message\" && question !== phoneCol) {\n        let options = customers[q_index][1].options;\n        for(let i=0; i < options.length; i++) {\n            console.log(options[i]);\n            console.log(value);\n            console.log(customers[phoneCol].options[i]);\n            if (options[i] === value) {\n                numbers.push(customers[phoneCol].options[i]);\n            } else if (options[i].indexOf(value) >= 0) {\n                numbers.push(customers[phoneCol].options[i]);\n            }\n        }\n      }\n      q_index++;\n    });\n    numbers = [...new Set(numbers)];\n    console.log(numbers);\n    return numbers;\n}\n\nfunction formatResponses(questions, responses) {\n    let obj = {};\n    for (let i = 0; i < questions.length; i++) {\n        let q = questions[i];\n        let all = [];\n        let a = responses.map((r) => {\n            if (r[i] && r[i].trim()) {\n                all.push(...r[i].split(','));\n            }\n            return r[i];\n        });\n        all = [...new Set(all)];\n        if (all.length > 0) {\n            obj[q] = {\n                responses: a,\n                options: all\n            };\n        }\n    }\n    return obj;\n}\n\n// Fetch a Google Sheet\nexport async function getResponses(sheetLink) {\n    const sheetID = sheetLink.slice(sheetLink.lastIndexOf(\"/d/\") + 3, sheetLink.lastIndexOf('/edit#'));\n    const pageID = sheetLink.slice(sheetLink.lastIndexOf(\"gid=\") + 4, sheetLink.length);\n\n    const doc = new GoogleSpreadsheet(sheetID, pageID);\n\n    try {\n        await doc.useApiKey(process.env.REACT_APP_SHEETS_API_KEY);\n        await doc.loadInfo();\n        let sheet = doc.sheetsById[pageID];\n        let rows = await sheet.getRows();\n        let responses = rows.map(r => r._rawData);\n        await sheet.loadHeaderRow();\n        let questions = sheet.headerValues;\n        return formatResponses(questions, responses);\n    } catch (e) {\n        console.error('Error: ', e);\n    }\n  }"]},"metadata":{},"sourceType":"module"}