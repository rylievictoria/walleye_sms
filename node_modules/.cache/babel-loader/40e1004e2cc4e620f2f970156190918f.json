{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rhendren/walleye_sms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rhendren/walleye_sms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import firebase from\"./firebase\";export function apiRequest(_x){return _apiRequest.apply(this,arguments);}// Create an Error with custom message and code\nfunction _apiRequest(){_apiRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(path){var method,data,accessToken,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:method=_args.length>1&&_args[1]!==undefined?_args[1]:\"GET\";data=_args.length>2?_args[2]:undefined;if(!firebase.auth().currentUser){_context.next=8;break;}_context.next=5;return firebase.auth().currentUser.getIdToken();case 5:_context.t0=_context.sent;_context.next=9;break;case 8:_context.t0=undefined;case 9:accessToken=_context.t0;return _context.abrupt(\"return\",fetch(\"/api/\".concat(path),{method:method,headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(accessToken)},body:data?JSON.stringify(data):undefined}).then(function(response){return response.json();}).then(function(response){if(response.status===\"error\"){// Automatically signout user if accessToken is no longer valid\nif(response.code===\"auth/invalid-user-token\"){firebase.auth().signOut();}throw new CustomError(response.code,response.message);}else{return response.data;}}));case 11:case\"end\":return _context.stop();}}},_callee);}));return _apiRequest.apply(this,arguments);}export function CustomError(code,message){var error=new Error(message);error.code=code;return error;}","map":{"version":3,"sources":["/Users/rhendren/walleye_sms/src/util/util.js"],"names":["firebase","apiRequest","path","method","data","auth","currentUser","getIdToken","undefined","accessToken","fetch","headers","Authorization","body","JSON","stringify","then","response","json","status","code","signOut","CustomError","message","error","Error"],"mappings":"iSAAA,MAAOA,CAAAA,QAAP,KAAqB,YAArB,CAEA,eAAsBC,CAAAA,UAAtB,+CA4BA;2FA5BO,iBAA0BC,IAA1B,8JAAgCC,MAAhC,+CAAyC,KAAzC,CAAgDC,IAAhD,uCACeJ,QAAQ,CAACK,IAAT,GAAgBC,WAD/B,+CAEKN,CAAAA,QAAQ,CAACK,IAAT,GAAgBC,WAAhB,CAA4BC,UAA5B,EAFL,2EAGDC,SAHC,QACCC,WADD,6CAKEC,KAAK,gBAASR,IAAT,EAAiB,CAC3BC,MAAM,CAAEA,MADmB,CAE3BQ,OAAO,CAAE,CACP,eAAgB,kBADT,CAEPC,aAAa,kBAAYH,WAAZ,CAFN,CAFkB,CAM3BI,IAAI,CAAET,IAAI,CAAGU,IAAI,CAACC,SAAL,CAAeX,IAAf,CAAH,CAA0BI,SANT,CAAjB,CAAL,CAQJQ,IARI,CAQC,SAACC,QAAD,QAAcA,CAAAA,QAAQ,CAACC,IAAT,EAAd,EARD,EASJF,IATI,CASC,SAACC,QAAD,CAAc,CAClB,GAAIA,QAAQ,CAACE,MAAT,GAAoB,OAAxB,CAAiC,CAC/B;AACA,GAAIF,QAAQ,CAACG,IAAT,GAAkB,yBAAtB,CAAiD,CAC/CpB,QAAQ,CAACK,IAAT,GAAgBgB,OAAhB,GACD,CAED,KAAM,IAAIC,CAAAA,WAAJ,CAAgBL,QAAQ,CAACG,IAAzB,CAA+BH,QAAQ,CAACM,OAAxC,CAAN,CACD,CAPD,IAOO,CACL,MAAON,CAAAA,QAAQ,CAACb,IAAhB,CACD,CACF,CApBI,CALF,yD,6CA6BP,MAAO,SAASkB,CAAAA,WAAT,CAAqBF,IAArB,CAA2BG,OAA3B,CAAoC,CACzC,GAAMC,CAAAA,KAAK,CAAG,GAAIC,CAAAA,KAAJ,CAAUF,OAAV,CAAd,CACAC,KAAK,CAACJ,IAAN,CAAaA,IAAb,CACA,MAAOI,CAAAA,KAAP,CACD","sourcesContent":["import firebase from \"./firebase\";\n\nexport async function apiRequest(path, method = \"GET\", data) {\n  const accessToken = firebase.auth().currentUser\n    ? await firebase.auth().currentUser.getIdToken()\n    : undefined;\n\n  return fetch(`/api/${path}`, {\n    method: method,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${accessToken}`,\n    },\n    body: data ? JSON.stringify(data) : undefined,\n  })\n    .then((response) => response.json())\n    .then((response) => {\n      if (response.status === \"error\") {\n        // Automatically signout user if accessToken is no longer valid\n        if (response.code === \"auth/invalid-user-token\") {\n          firebase.auth().signOut();\n        }\n\n        throw new CustomError(response.code, response.message);\n      } else {\n        return response.data;\n      }\n    });\n}\n\n// Create an Error with custom message and code\nexport function CustomError(code, message) {\n  const error = new Error(message);\n  error.code = code;\n  return error;\n}\n"]},"metadata":{},"sourceType":"module"}