{"ast":null,"code":"import _toConsumableArray from\"/Users/rhendren/walleye_sms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/rhendren/walleye_sms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import FormField from\"./FormField\";import SectionButton from\"./SectionButton\";import{useAuth}from\"./../util/auth.js\";import{useRouter}from\"./../util/router.js\";import{useForm,reset}from\"react-hook-form\";import{getResponses,filterNumbers}from\"./../util/sheets.js\";import{sendSms}from\"./../util/twilio.js\";function DashboardSms(props){var auth=useAuth();var router=useRouter();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),pending=_useState2[0],setPending=_useState2[1];var _useState3=useState(\"Number\"),_useState4=_slicedToArray(_useState3,2),phoneCol=_useState4[0],setPhoneCol=_useState4[1];var _useState5=useState({\"Name\":{responses:[\"Rylie\",\"Jordan\"],options:[\"Rylie\",\"Jordan\"]},\"Number\":{responses:[\"+12624243872\",\"+6309010523\"],options:[\"+2624243872\",\"+6309010523\"]},\"Pizza Topping\":{responses:[\"Pepperoni\",[\"Cheese\",\"Sausage\"]],options:[\"Pepperoni\",\"Cheese\",\"Sausage\"]},\"Favorite Color\":{responses:[[\"Red\",\"Blue\"],\"Green\"],options:[\"Red\",\"Blue\",\"Green\"]}}),_useState6=_slicedToArray(_useState5,2),customers=_useState6[0],setCustomers=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),formAlert=_useState8[0],setFormAlert=_useState8[1];useEffect(function(){console.log(auth.user);if(auth.user.planIsActive&&!auth.user.sheetLink){alert(\"You need to enter a sheet link first to not use default values!\");}else if(auth.user.planIsActive&&!auth.user.phoneCol){alert(\"You need to specify the phone number column first to not use default values!\");}else if(!auth.user.planIsActive){alert(\"You need to sign up for a subscription not to use default values!\");}else if(auth.user.planIsActive&&auth.user.sheetLink&&auth.user.phoneCol){setPending(true);getResponses(auth.user.sheetLink).then(function(c){setCustomers(c);setPhoneCol(auth.user.phoneCol);}).catch(function(e){console.error('Error: ',e);});setPending(false);}else{// Alert that no subscription and should sign up\n// Redirect to checkout?\nconsole.log(auth.user);}},[auth.user]);var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.errors,reset=_useForm.reset;var onSubmit=function onSubmit(data){setPending(true);var message=data.message;var numbers=filterNumbers(data,customers,phoneCol);var cost=numbers.length*0.10;if(!(auth.user.smsFunds>0)||cost>auth.user.smsFunds){if(auth.user.planIsActive){alert(\"You have \".concat(auth.user.smsFunds,\" and this costs \").concat(cost,\"! Refill your account.\"));router.push(\"/purchase/sms?quantity=\".concat(numbers.length));}else{alert(\"You have no subscription! Please sign up.\");router.push(\"/pricing\");}}console.log('Message: '+message);console.log('Numbers: '+numbers);numbers.forEach(function(num){sendSms(num,message).then(function(status){var delivery={to:status.to,from:status.from,body:status.body,dateSent:status.dateSent,errorMessage:status.errorMessage};if(auth.user.deliveries){delivery=[].concat(_toConsumableArray(auth.user.deliveries),[delivery]);}else{delivery=[delivery];}auth.updateProfile({smsFunds:auth.user.smsFunds-0.10,deliveries:delivery});}).catch(function(error){alert(error.message);}).finally(function(){console.log('SMS Funds left: '+auth.user.smsFunds);});});// Reset filters and what not\nreset();setPending(false);};return/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit(onSubmit)},!pending&&Object.entries(customers).map(function(_ref){var _ref2=_slicedToArray(_ref,2),q=_ref2[0],values=_ref2[1];return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h3\",{className:\"is-primary\"},q),values.options.map(function(a){return/*#__PURE__*/React.createElement(FormField,{id:a,name:q+\"|||\"+a,type:\"checkbox\",inputRef:register(),error:errors.q});}),/*#__PURE__*/React.createElement(\"br\",null));}),/*#__PURE__*/React.createElement(FormField,{name:\"message\",type:\"textarea\",label:\"Please enter your SMS\",placeholder:\"Write to your people\",error:errors.message,inputRef:register({required:\"Please enter your text message to send!\"})}),/*#__PURE__*/React.createElement(\"div\",{className:\"field\"},/*#__PURE__*/React.createElement(\"div\",{className:\"control\"},/*#__PURE__*/React.createElement(SectionButton,{parentColor:props.parentColor,size:\"medium\",state:pending?\"loading\":\"normal\"},\"Send\"))));}export default DashboardSms;","map":{"version":3,"sources":["/Users/rhendren/walleye_sms/src/components/DashboardSms.js"],"names":["React","useState","useEffect","FormField","SectionButton","useAuth","useRouter","useForm","reset","getResponses","filterNumbers","sendSms","DashboardSms","props","auth","router","pending","setPending","phoneCol","setPhoneCol","responses","options","customers","setCustomers","formAlert","setFormAlert","console","log","user","planIsActive","sheetLink","alert","then","c","catch","e","error","register","handleSubmit","errors","onSubmit","data","message","numbers","cost","length","smsFunds","push","forEach","num","status","delivery","to","from","body","dateSent","errorMessage","deliveries","updateProfile","finally","Object","entries","map","q","values","a","required","parentColor"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport FormField from \"./FormField\";\nimport SectionButton from \"./SectionButton\";\nimport { useAuth } from \"./../util/auth.js\";\nimport { useRouter } from \"./../util/router.js\";\nimport { useForm, reset } from \"react-hook-form\";\nimport { getResponses, filterNumbers } from \"./../util/sheets.js\";\nimport { sendSms } from \"./../util/twilio.js\";\n\nfunction DashboardSms(props) {\n  const auth = useAuth();\n  const router = useRouter();\n  const [pending, setPending] = useState(false);\n  const [phoneCol, setPhoneCol] = useState(\"Number\");\n  const [customers, setCustomers] = useState({\n    \"Name\": {responses: [\"Rylie\", \"Jordan\"], options: [\"Rylie\", \"Jordan\"]},\n    \"Number\": {responses: [\"+12624243872\", \"+6309010523\"], options: [\"+2624243872\", \"+6309010523\"]},\n    \"Pizza Topping\": {responses: [\"Pepperoni\", [\"Cheese\", \"Sausage\"]], options: [\"Pepperoni\", \"Cheese\", \"Sausage\"]},\n    \"Favorite Color\": {responses: [[\"Red\", \"Blue\"], \"Green\"], options: [\"Red\", \"Blue\", \"Green\"]}\n  });\n  const [formAlert, setFormAlert] = useState(null);\n\n  useEffect(() => {\n      console.log(auth.user);\n      if (auth.user.planIsActive && !auth.user.sheetLink) {\n        alert(\"You need to enter a sheet link first to not use default values!\");\n      } else if (auth.user.planIsActive && !auth.user.phoneCol) {\n        alert(\"You need to specify the phone number column first to not use default values!\");\n      } else if (!auth.user.planIsActive) {\n        alert(\"You need to sign up for a subscription not to use default values!\");\n      } else if (auth.user.planIsActive && auth.user.sheetLink && auth.user.phoneCol) {\n        setPending(true);\n        getResponses(auth.user.sheetLink)\n        .then((c) => {\n          setCustomers(c);\n          setPhoneCol(auth.user.phoneCol);\n        })\n        .catch((e) => {\n          console.error('Error: ', e);\n        });\n        setPending(false);\n      }\n      else {\n        // Alert that no subscription and should sign up\n        // Redirect to checkout?\n        console.log(auth.user);\n      }\n    }, [auth.user]);\n\n  const { register, handleSubmit, errors, reset } = useForm();\n\n  const onSubmit = (data) => {\n    setPending(true);\n\n    const message = data.message;\n    const numbers = filterNumbers(data, customers, phoneCol);\n    const cost = numbers.length * 0.10;\n  \n    if (!(auth.user.smsFunds > 0) || cost > auth.user.smsFunds) {\n      if (auth.user.planIsActive) {\n        alert(`You have ${auth.user.smsFunds} and this costs ${cost}! Refill your account.`)\n        router.push(`/purchase/sms?quantity=${numbers.length}`);\n      } else {\n        alert(\"You have no subscription! Please sign up.\")\n        router.push(`/pricing`);\n      }\n    }\n\n    console.log('Message: '+message);\n    console.log('Numbers: '+numbers);\n\n    numbers.forEach((num) => {\n      sendSms(num, message)\n      .then((status) => {\n          let delivery = {\n            to: status.to,\n            from: status.from,\n            body: status.body,\n            dateSent: status.dateSent,\n            errorMessage: status.errorMessage\n          }\n          if (auth.user.deliveries) {\n            delivery = [...auth.user.deliveries, delivery];\n          } else {\n            delivery = [delivery];\n          }\n          auth.updateProfile({\n            smsFunds: auth.user.smsFunds - 0.10,\n            deliveries: delivery\n          });\n      })\n      .catch((error) => {\n          alert(error.message);\n      })\n      .finally(() => {\n        console.log('SMS Funds left: '+auth.user.smsFunds);\n      });\n    });\n\n    // Reset filters and what not\n    reset();\n    setPending(false);\n  };\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)}>\n      {!pending && Object.entries(customers).map(([q, values]) => (\n          <div>\n              <h3 className=\"is-primary\">{q}</h3>\n              {values.options.map((a) => (\n                  <FormField\n                      id={a}\n                      name={q+\"|||\"+a}\n                      type=\"checkbox\"\n                      inputRef={register()}\n                      error={errors.q}\n                  />)\n              )}\n              <br />\n          </div>\n        )\n      )}\n      <FormField\n        name=\"message\"\n        type=\"textarea\"\n        label=\"Please enter your SMS\"\n        placeholder=\"Write to your people\"\n        error={errors.message}\n        inputRef={register({\n          required: \"Please enter your text message to send!\",\n        })}\n      />\n      <div className=\"field\">\n        <div className=\"control\">\n          <SectionButton\n            parentColor={props.parentColor}\n            size=\"medium\"\n            state={pending ? \"loading\" : \"normal\"}\n          >\n            Send\n          </SectionButton>\n        </div>\n      </div>\n    </form>\n  );\n}\n\nexport default DashboardSms;\n"]},"metadata":{},"sourceType":"module"}